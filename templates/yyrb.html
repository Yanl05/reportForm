{% extends "home.html" %}

{% block page-main %}
    <link href="static/style/bootstrap.css" rel="stylesheet">
    <!-- Font awesome icon -->
    <link rel="stylesheet" href="static/style/font-awesome.css">
    <!-- jQuery UI -->
    <link rel="stylesheet" href="static/style/jquery-ui.css">
    <!-- Calendar -->
    <link rel="stylesheet" href="static/style/fullcalendar.css">
    <!-- prettyPhoto -->
    <link rel="stylesheet" href="static/style/prettyPhoto.css">
    <!-- Star rating -->
    <link rel="stylesheet" href="static/style/rateit.css">
    <!-- Date picker -->
    <link rel="stylesheet" href="static/style/bootstrap-datetimepicker.min.css">
    <!-- CLEditor -->
    <link rel="stylesheet" href="static/style/jquery.cleditor.css">
    <!-- Uniform -->
    <link rel="stylesheet" href="static/style/uniform.default.css">
    <!-- Bootstrap toggle -->
    <link rel="stylesheet" href="static/style/bootstrap-switch.css">
    <!-- Main stylesheet -->
    <link href="static/style/style.css" rel="stylesheet">
    <!-- Widgets stylesheet -->
    <link href="static/style/widgets.css" rel="stylesheet">
    {#时间选择#}
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
        <legend>医院日报</legend>
    </fieldset>

    <div class="matter">
        <div class="container">

          <!-- Today status. jQuery Sparkline plugin used. -->

          <div class="row">
            <div class="col-md-12">
              <!-- List starts -->
              <ul class="today-datas">
                <!-- List #1 -->
                <li>
                  <!-- Graph -->
                  <div><span id="todayspark1" class="spark"></span></div>
                  <!-- Text -->
                  <div class="datas-text">12,000 visitors/day</div>
                </li>
                <li>
                  <div><span id="todayspark2" class="spark"></span></div>
                  <div class="datas-text">30,000 Pageviews</div>
                </li>
                <li>
                  <div><span id="todayspark3" class="spark"></span></div>
                  <div class="datas-text">15.66% Bounce Rate</div>
                </li>
                <li>
                  <div><span id="todayspark4" class="spark"></span></div>
                  <div class="datas-text">$12,000 Revenue/Day</div>
                </li>
                <li>
                  <div><span id="todayspark5" class="spark"></span></div>
                  <div class="datas-text">15,000000 visitors till date</div>
                </li>
              </ul>
            </div>
          </div>

          <!-- Today status ends -->

          <!-- Dashboard Graph starts -->

          <div class="row">
            <div class="col-md-8">

              <!-- Widget -->
              <div class="widget">
                <!-- Widget head -->
                <div class="widget-head">
                  <div class="pull-left">图表</div>
                  <div class="widget-icons pull-right">
                    <a href="#" class="wminimize"><i class="icon-chevron-up"></i></a>
                    <a href="#" class="wclose"><i class="icon-remove"></i></a>
                  </div>
                  <div class="clearfix"></div>
                </div>

                <!-- Widget content -->
                <div class="widget-content">
                  <div class="padd">

                    <!-- Curve chart (Blue color). jQuery Flot plugin used. -->
                    <div id="curve-chart"></div>

                    <hr />
                    <!-- Hover location -->
                    <div id="hoverdata">Mouse hovers at
                    (<span id="x">0</span>, <span id="y">0</span>). <span id="clickdata"></span></div>

                    <!-- Skil this line. <div class="uni"><input id="enableTooltip" type="checkbox">Enable tooltip</div> -->

                  </div>
                </div>
                <!-- Widget ends -->

              </div>
            </div>

            <div class="col-md-4">

              <div class="widget">

                <div class="widget-head">
                  <div class="pull-left">今天统计</div>
                  <div class="widget-icons pull-right">
                    <a href="#" class="wminimize"><i class="icon-chevron-up"></i></a>
                    <a href="#" class="wclose"><i class="icon-remove"></i></a>
                  </div>
                  <div class="clearfix"></div>
                </div>

                <div class="widget-content">
                  <div class="padd">

                    <!-- Visitors, pageview, bounce rate, etc., Sparklines plugin used -->
                    <ul class="current-status">
                      <li>
                        <span id="status1"></span> <span class="bold">Visits : 2000</span>
                      </li>
                      <li>
                        <span id="status2"></span> <span class="bold">Unique Visitors : 1,345</span>
                      </li>
                      <li>
                        <span id="status3"></span> <span class="bold">Pageviews : 2000</span>
                      </li>
                      <li>
                        <span id="status4"></span> <span class="bold">Pages / Visit : 2000</span>
                      </li>
                      <li>
                        <span id="status5"></span> <span class="bold">Avg. Visit Duration : 2000</span>
                      </li>
                      <li>
                        <span id="status6"></span> <span class="bold">Bounce Rate : 2000</span>
                      </li>
                      <li>
                        <span id="status7"></span> <span class="bold">% New Visits : 2000</span>
                      </li>
                    </ul>

                  </div>
                </div>

              </div>

            </div>
          </div>
          <!-- Dashboard graph ends -->

          <!-- Chats, File upload and Recent Comments -->
          <div class="row">

            <div class="col-md-4">
              <!-- Widget -->
              <div class="widget">
                <!-- Widget title -->
                <div class="widget-head">
                  <div class="pull-left">图表</div>
                  <div class="widget-icons pull-right">
                    <a href="#" class="wminimize"><i class="icon-chevron-up"></i></a>
                    <a href="#" class="wclose"><i class="icon-remove"></i></a>
                  </div>
                  <div class="clearfix"></div>
                </div>

                <div class="widget-content">
                  <!-- Widget content -->
                  <div class="padd">

                    <ul class="chats">

                      <!-- Chat by us. Use the class "by-me". -->
                      <li class="by-me">
                        <!-- Use the class "pull-left" in avatar -->
                        <div class="avatar pull-left">
                          <img src="img/user.jpg" alt=""/>
                        </div>

                        <div class="chat-content">
                          <!-- In meta area, first include "name" and then "time" -->
                          <div class="chat-meta">Ashok <span class="pull-right">3 hours ago</span></div>
                          Vivamus diam elit diam, consectetur dapibus adipiscing elit.
                          <div class="clearfix"></div>
                        </div>
                      </li>

                      <!-- Chat by other. Use the class "by-other". -->
                      <li class="by-other">
                        <!-- Use the class "pull-right" in avatar -->
                        <div class="avatar pull-right">
                          <img src="img/user.jpg" alt=""/>
                        </div>

                        <div class="chat-content">
                          <!-- In the chat meta, first include "time" then "name" -->
                          <div class="chat-meta">3 hours ago <span class="pull-right">Ravi</span></div>
                          Vivamus diam elit diam, consectetur fconsectetur dapibus adipiscing elit.
                          <div class="clearfix"></div>
                        </div>
                      </li>

                      <li class="by-me">
                        <div class="avatar pull-left">
                          <img src="img/user.jpg" alt=""/>
                        </div>

                        <div class="chat-content">
                          <div class="chat-meta">Ashok <span class="pull-right">4 hours ago</span></div>
                          Vivamus diam elit diam, consectetur fermentum sed dapibus eget, Vivamus consectetur dapibus adipiscing elit.
                          <div class="clearfix"></div>
                        </div>
                      </li>

                      <li class="by-other">
                        <!-- Use the class "pull-right" in avatar -->
                        <div class="avatar pull-right">
                          <img src="img/user.jpg" alt=""/>
                        </div>

                        <div class="chat-content">
                          <!-- In the chat meta, first include "time" then "name" -->
                          <div class="chat-meta">3 hours ago <span class="pull-right">Ravi</span></div>
                          Vivamus diam elit diam, consectetur fermentum sed dapibus eget, Vivamus consectetur dapibus adipiscing elit.
                          <div class="clearfix"></div>
                        </div>
                      </li>

                    </ul>

                  </div>
                  <!-- Widget footer -->
                  <div class="widget-foot">

                      <form class="form-inline">
						<div class="form-group">
							<input type="text" class="form-control" placeholder="Type your message here...">
						</div>
                        <button type="submit" class="btn btn-primary">Send</button>
                      </form>


                  </div>
                </div>


              </div>
            </div>


            <!-- File Upload widget -->
            <div class="col-md-4">
              <div class="widget">
                <!-- Widget title -->
                <div class="widget-head">
                  <div class="pull-left">文件上传</div>
                  <div class="widget-icons pull-right">
                    <a href="#" class="wminimize"><i class="icon-chevron-up"></i></a>
                    <a href="#" class="wclose"><i class="icon-remove"></i></a>
                  </div>
                  <div class="clearfix"></div>
                </div>

                <div class="widget-content">
                  <!-- Widget content -->
                  <ul class="file-upload">

                    <li>
                      <strong><i class="icon-upload-alt"></i> File_Name_Here.Mp3</strong>
                      <div class="file-meta">3.3 of 5MB - 5 mins - 1MB/Sec</div>

                      <div class="progress progress-animated progress-striped">
						  <div class="progress-bar progress-bar-success" data-percentage="100">
							<span class="sr-only">100 % completed</span>
						  </div>
					  </div>
                    </li>

                    <li>
                      <strong><i class="icon-ok"></i> Third_File_Here.Mp3</strong>
                      <div class="file-meta">5MB - 5 mins - Stopped</div>
                    </li>

                    <li>
                      <strong><i class="icon-ok"></i> Third_File_Here.Mp3</strong>
                      <div class="file-meta">5MB - 5 mins - Stopped</div>
                    </li>
                  </ul>

                  <div class="widget-foot">
                  </div>

                </div>
              </div>

              <div class="widget">
                <!-- Widget title -->
                <div class="widget-head">
                  <div class="pull-left">浏览器统计</div>
                  <div class="widget-icons pull-right">
                    <a href="#" class="wminimize"><i class="icon-chevron-up"></i></a>
                    <a href="#" class="wclose"><i class="icon-remove"></i></a>
                  </div>
                  <div class="clearfix"></div>
                </div>
                <div class="widget-content referrer">
                  <!-- Widget content -->

                  <table class="table table-striped table-bordered table-hover">
                    <tr>
                      <th><center>#</center></th>
                      <th>Browsers</th>
                      <th>Visits</th>
                    </tr>
                    <tr>
                      <td><img src="img/icons/chrome.png" alt="" />
                      <td>Google Chrome</td>
                      <td>3,005</td>
                    </tr>
                    <tr>
                      <td><img src="img/icons/firefox.png" alt="" />
                      <td>Mozilla Firefox</td>
                      <td>2,505</td>
                    </tr>
                    <tr>
                      <td><img src="img/icons/ie.png" alt="" />
                      <td>Internet Explorer</td>
                      <td>1,405</td>
                    </tr>
                    <tr>
                      <td><img src="img/icons/opera.png" alt="" />
                      <td>Opera</td>
                      <td>4,005</td>
                    </tr>
                    <tr>
                      <td><img src="img/icons/safari.png" alt="" />
                      <td>Safari</td>
                      <td>505</td>
                    </tr>
                  </table>

                  <div class="widget-foot">
                  </div>
                </div>
              </div>

            </div>


            <div class="col-md-4">
              <!-- Widget -->
              <div class="widget">
                <!-- Widget title -->
                <div class="widget-head">
                  <div class="pull-left">最近评论</div>
                  <div class="widget-icons pull-right">
                    <a href="#" class="wminimize"><i class="icon-chevron-up"></i></a>
                    <a href="#" class="wclose"><i class="icon-remove"></i></a>
                  </div>
                  <div class="clearfix"></div>
                </div>
                <div class="widget-content">
                  <!-- Widget content -->
                  <div class="padd">

                    <ul class="recent">


                      <li>

                        <div class="recent-content">
                          <div class="recent-meta">Posted on 25/1/2120 by Ashok</div>
                          <div>Vivamus diam elit diam, consectetur fermentum sed dapibus eget, Vivamus consectetur dapibus adipiscing elit.
                          </div>

                          <div class="btn-group">
                            <button class="btn btn-xs btn-default"><i class="icon-ok"></i> </button>
                            <button class="btn btn-xs btn-default"><i class="icon-pencil"></i> </button>
                            <button class="btn btn-xs btn-default"><i class="icon-remove"></i> </button>
                          </div>

                          <button class="btn btn-xs btn-danger pull-right">Spam</button>

                          <div class="clearfix"></div>
                        </div>
                      </li>



                      <li>

                        <div class="recent-content">
                          <div class="recent-meta">Posted on 25/1/2120 by Ashok</div>
                          <div>Vivamus diam elit diam, consectetur fermentum sed dapibus eget, Vivamus consectetur dapibus adipiscing elit.
                          </div>

                          <div class="btn-group">
                            <button class="btn btn-xs btn-default"><i class="icon-ok"></i> </button>
                            <button class="btn btn-xs btn-default"><i class="icon-pencil"></i> </button>
                            <button class="btn btn-xs btn-default"><i class="icon-remove"></i> </button>
                          </div>

                          <button class="btn btn-xs btn-danger pull-right">Spam</button>

                          <div class="clearfix"></div>
                        </div>
                      </li>



                      <li>

                        <div class="recent-content">
                          <div class="recent-meta">Posted on 25/1/2120 by Ashok</div>
                          <div>Vivamus diam elit diam, consectetur fermentum sed dapibus eget, Vivamus consectetur dapibus adipiscing elit.
                          </div>

                          <div class="btn-group">
                            <button class="btn btn-xs btn-default"><i class="icon-ok"></i> </button>
                            <button class="btn btn-xs btn-default"><i class="icon-pencil"></i> </button>
                            <button class="btn btn-xs btn-default"><i class="icon-remove"></i> </button>
                          </div>

                          <button class="btn btn-xs btn-danger pull-right">Spam</button>

                          <div class="clearfix"></div>
                        </div>
                      </li>


                    </ul>

                  </div>
                  <!-- Widget footer -->
                  <div class="widget-foot">


                      <ul class="pagination pull-right">
                        <li><a href="#">Prev</a></li>
                        <li><a href="#">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#">4</a></li>
                        <li><a href="#">Next</a></li>
                      </ul>

                    <div class="clearfix"></div>

                  </div>
                </div>

              </div>

            </div>
          </div>


          <div class="row">
            <div class="col-md-6">
              <div class="widget wblack">
                <div class="widget-head">
                  <div class="pull-left">黑色图表</div>
                  <div class="widget-icons pull-right">
                    <a href="#" class="wminimize"><i class="icon-chevron-up"></i></a>
                    <a href="#" class="wclose"><i class="icon-remove"></i></a>
                  </div>
                  <div class="clearfix"></div>
                </div>
                <div class="widget-content">
                  <div class="padd">

                   <div id="bar-chart"></div>

                  </div>
                  <div class="widget-foot">
                    <!-- Footer goes here -->
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="widget">
                <div class="widget-head">
                  <div class="pull-left">快速提交</div>
                  <div class="widget-icons pull-right">
                    <a href="#" class="wminimize"><i class="icon-chevron-up"></i></a>
                    <a href="#" class="wclose"><i class="icon-remove"></i></a>
                  </div>
                  <div class="clearfix"></div>
                </div>
                <div class="widget-content">
                  <div class="padd">

                      <div class="form quick-post">
                                      <!-- Edit profile form (not working)-->
                                      <form class="form-horizontal">
                                          <!-- Title -->
                                          <div class="form-group">
                                            <label class="control-label col-lg-3" for="title">Title</label>
                                            <div class="col-lg-9">
                                              <input type="text" class="form-control" id="title">
                                            </div>
                                          </div>
                                          <!-- Content -->
                                          <div class="form-group">
                                            <label class="control-label col-lg-3" for="content">Content</label>
                                            <div class="col-lg-9">
                                              <textarea class="form-control" id="content"></textarea>
                                            </div>
                                          </div>
                                          <!-- Cateogry -->
                                          <div class="form-group">
                                            <label class="control-label col-lg-3">Category</label>
                                            <div class="col-lg-9">
                                                <select class="form-control">
                                                  <option value="">- Choose Cateogry -</option>
                                                  <option value="1">General</option>
                                                  <option value="2">News</option>
                                                  <option value="3">Media</option>
                                                  <option value="4">Funny</option>
                                                </select>
                                            </div>
                                          </div>
                                          <!-- Tags -->
                                          <div class="form-group">
                                            <label class="control-label col-lg-3" for="tags">Tags</label>
                                            <div class="col-lg-9">
                                              <input type="text" class="form-control" id="tags">
                                            </div>
                                          </div>

                                          <!-- Buttons -->
                                          <div class="form-group">
                                             <!-- Buttons -->
											 <div class="col-lg-offset-2 col-lg-9">
												<button type="submit" class="btn btn-success">Publish</button>
												<button type="submit" class="btn btn-danger">Save Draft</button>
												<button type="reset" class="btn btn-default">Reset</button>
											 </div>
                                          </div>
                                      </form>
                                    </div>


                  </div>
                  <div class="widget-foot">
                    <!-- Footer goes here -->
                  </div>
                </div>
              </div>
            </div>
          </div>


        </div>
		  </div>

		<!-- Matter ends -->

    {#    <script src="/static/layui/layui.js"></script>#}
    {#    <script src="/static/jquery-3.3.1.js"></script>#}
    <script>
        var tabledata = '';
        // 设置文件flag 有文件时，才能点击发送邮件
        var havefile = 0;
        layui.use('laydate', function () {
            var laydate = layui.laydate;

//执行一个laydate实例

//日期范围
            laydate.render({
                elem: '#time1',
                min: '2021-01-01'
                , range: true
            });
            console.log(laydate);
//年范围
            laydate.render({
                elem: '#test7'
                , type: 'year'
                , range: true
            });
        });

        // 查询数据
        $("#query-button").click(function () {
            // 1.获取起始时间
            var time = $("#time1").val();

            console.log(time);
            if (time === "") {
                // 如果输入信息为空 弹窗提示
                layui.use('layer', function () {
                    var layer = layui.layer;
                    layer.alert('请选择日期');
                });
            } else {
                $.ajax({
                        url: "zyyb",
                        type: "post",
                        data: {
                            "time": time
                        },
                        success: function (data) {
                            if (data.status === 0) {
                                layui.use('layer', function () {
                                    var layer = layui.layer;
                                    layer.alert('检索失败！\n请重新输入药品代码、选择时间。');
                                });
                            } else {
                                tabledata = data.data;
                                console.log(typeof (data));
                                console.log(tabledata);
                                console.log(data.status);
                                havefile = data.status;
                                layui.use('table', function () {
                                    var table = layui.table;
//展示已知数据
                                    table.render({
                                        elem: '#table1'
                                        , url: ''
                                        , data: tabledata
                                        , toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板
                                        , defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
                                            title: '提示'
                                            , layEvent: 'LAYTABLE_TIPS'
                                            , icon: 'layui-icon-tips'
                                        }]
                                        , title: '住院药比:' + time
                                        , cols: [[
                                            {field: 'dept_name', title: '科室名称', totalRowText: '合计行'}
                                            , {field: 'total_cost', title: '总费用', sort: true, totalRow: true}
                                            , {field: 'xy', title: '西药', sort: true, totalRow: true}
                                            , {field: 'zcy', title: '中成药', sort: true, totalRow: true}
                                            , {field: 'ptzj', title: '普通制剂', sort: true, totalRow: true}
                                            {#, {field: 'gf', title: '膏方',  sort: true, totalRow: true}#}
                                            , {field: 'ctyp', title: '传统饮片', sort: true, totalRow: true}
                                            , {field: 'jzyp', title: '精制饮片', sort: true, totalRow: true}
                                            , {field: 'cw', title: '超微', sort: true, totalRow: true}
                                            {#                                            , {field: 'krt', title: '康仁堂', sort: true, totalRow: true}#}
                                            {#                                            , {field: 'xl', title: '新绿',  sort: true, totalRow: true}#}
                                            {#                                            , {field: 'sj', title: '三九',  sort: true, totalRow: true}#}
                                            , {field: 'otherDrug', title: '其他药品', sort: true, totalRow: true}

                                        ]]
                                        , page: true
                                        , totalRow: true
                                        , limit: 50
                                    });

                                })
                            }

                        }
                    }
                )
            }
        });

        // 发送邮件到指定邮箱
        $("#send-button").click(function () {
            if (havefile === 0) {
                layui.use('layer', function () {
                    var layer = layui.layer;
                    layer.alert('没有要发送的结果，请先查询数据');
                });
            } else {
                var emailaddr = $("#emailaddr").val();
                var reg = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$"); //正则表达式
                var obj = document.getElementById("emailaddr"); //要验证的对象
                if (obj.value === "") { //输入不能为空
                    layui.use('layer', function () {
                        var layer = layui.layer;
                        layer.alert('请填写邮箱');
                    });
                } else if (!reg.test(obj.value)) { //正则验证不通过，格式不对
                    layui.use('layer', function () {
                        var layer = layui.layer;
                        layer.alert('邮箱格式不正确');
                    });
                } else {
                    $.ajax({
                        url: "/sendemail/",
                        type: "post",
                        data: {
                            "emailaddr": emailaddr
                        },
                        success: function (data) {
                            console.log(data);
                            if (data.status === 1) {
                                layui.use('layer', function () {
                                    var layer = layui.layer;
                                    layer.alert('邮件发送成功! 请注意查收');
                                });
                            } else if (data.status === 0) {
                                layui.use('layer', function () {
                                    var layer = layui.layer;
                                    layer.alert('邮件发送失败');
                                });
                            }
                        }
                    })
                }
            }

        });

        // 重置代码输入框
        $("#resetcode").click(function () {
            $("#time1").val("")

        });


    </script>
{% endblock %}

<!--
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>药品销量查询</title>
    <link rel="stylesheet" href="/static/layui/css/layui.css" media="all">
</head>
<body>

时间选择
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
    <legend>指定时间指定药品全院销量查询</legend>
</fieldset>

<div class="layui-form">
    <div class="layui-form-item">
        <div class="layui-row layui-col-space10">
            <label class="layui-form-label">日期范围</label>
            <div class="layui-input-inline layui-col-md4">
                <input type="text" class="layui-input" id="time1" placeholder="请选择起始日期">
            </div>
            <div>
                <button type="button" class="layui-btn layui-btn-radius" id="query-button">查询</button>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">药品代码</label>

                <div class="layui-input-block">
                    <textarea placeholder="请输入药品代码(如有多个，请通过空格分开)" class="layui-textarea" id="textcode"
                              style="width:800px;"></textarea>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-input-block layui-row">
                    <div class="layui-col-md4">
                        <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1"
                                id="query-button">立即提交
                        </button>
                        <button type="reset"
                                class="layui-btn layui-btn-primary"
                                id="resetcode">重置
                        </button>
                    </div>
                </div>


            </div>


        </div>

    </div>
</div>

<div class="layui-form">
    <div class="layui-col-md4 layui-row">

        <label class="layui-form-label">收件邮箱:</label>
        <div class="layui-input-inline" style="display: flex;flex-direction: row;">
            <input type="text" name="email" lay-verify="email" autocomplete="off"
                   class="layui-input" style="width:180px;" id="emailaddr">
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1"
                    id="send-button">立即发送
            </button>

        </div>
    </div>
</div>

数据显示表格
<div class="layui-row">
    <table class="layui-hide" id="table1" lay-filter="table1"></table>
</div>

<script src="/static/layui/layui.js"></script>
<script src="/static/jquery-3.3.1.js"></script>
<script>
    var tabledata = '';
    // 设置文件flag 有文件时，才能点击发送邮件
    var havefile = 0
    layui.use('laydate', function () {
        var laydate = layui.laydate;

//执行一个laydate实例

//日期范围
        laydate.render({
            elem: '#time1',
            min: '2020-06-30'
            , range: true
        });
        console.log(laydate)
    });

    // 查询数据
    $("#query-button").click(function () {
// 1.获取起始时间
        var time = $("#time1").val();
        var textcode = $("#textcode").val();
        console.log(time);
        if (time === "" || textcode === "") {
// 如果输入信息为空 弹窗提示
            layui.use('layer', function () {
                var layer = layui.layer;
                layer.alert('请选择日期，并且输入至少一个药品代码！\n请注意多个药品代码之间请用空格分隔');
            });
        } else {
            $.ajax({
                    url: "/query/",
                    type: "post",
                    data: {
                        "time": time,
                        "textcode": textcode
                    },
                    success: function (data) {
                        if (data.status === 0) {
                            layui.use('layer', function () {
                                var layer = layui.layer;
                                layer.alert('检索失败！\n请重新输入药品代码、选择时间。');
                            });
                        } else {
                            tabledata = data.data;
                            console.log(typeof(data));
                            console.log(tabledata);
                            console.log(data.status);
                            havefile = data.status;
                            layui.use('table', function () {
                                var table = layui.table;
//展示已知数据
                                table.render({
                                    elem: '#table1'
                                    , url: ''
                                    , data: tabledata
                                    , toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板
                                    , defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
                                        title: '提示'
                                        , layEvent: 'LAYTABLE_TIPS'
                                        , icon: 'layui-icon-tips'
                                    }]
                                    , title: '用户数据表'
                                    , cols: [[
                                        {field: '药品代码', title: '药品代码', width: 120, edit: 'text', totalRowText: '合计行'}
                                        , {field: '药品名称', title: '药品名称', width: 150, edit: 'text'}
                                        , {field: '数量', title: '数量', width: 100, sort: true, totalRow: true}
                                        , {field: '单价', title: '单价', width: 80, edit: 'text', sort: true}
                                        , {field: '总金额', title: '总金额', width: 120, edit: 'text', sort: true, totalRow: true}
                                    ]]
                                    , page: true
                                    , totalRow: true
                                });

                            })
                        }

                    }
                }
            )
        }
    });

    // 发送邮件到指定邮箱
    $("#send-button").click(function () {
        if (havefile === 0) {
            layui.use('layer', function () {
                var layer = layui.layer;
                layer.alert('没有要发送的结果，请先查询数据');
            });
        } else {
            var emailaddr = $("#emailaddr").val();
            var reg = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$"); //正则表达式
            var obj = document.getElementById("emailaddr"); //要验证的对象
            if (obj.value === "") { //输入不能为空
                layui.use('layer', function () {
                    var layer = layui.layer;
                    layer.alert('请填写邮箱');
                });
            } else if (!reg.test(obj.value)) { //正则验证不通过，格式不对
                layui.use('layer', function () {
                    var layer = layui.layer;
                    layer.alert('邮箱格式不正确');
                });
            } else {
                $.ajax({
                    url: "/sendemail/",
                    type: "post",
                    data: {
                        "emailaddr": emailaddr
                    },
                    success: function (data) {
                        console.log(data);
                        if (data.status === 1) {
                            layui.use('layer', function () {
                                var layer = layui.layer;
                                layer.alert('邮件发送成功! 请注意查收');
                            });
                        } else if (data.status === 0) {
                            layui.use('layer', function () {
                                var layer = layui.layer;
                                layer.alert('邮件发送失败');
                            });
                        }
                    }
                })
            }
        }

    });

    // 重置代码输入框
    $("#resetcode").click(function () {
        $("#textcode").val("")

    })


</script>
</body>
</html>

-->